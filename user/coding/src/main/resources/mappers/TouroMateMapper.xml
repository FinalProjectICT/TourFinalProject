<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.coding.dao.TouroMateDAO">
    <!-- 여행 친구 찾기 게시글 리스트 -->
   <select id="getSelectedMateList" resultType="TouroMateVO">
        SELECT touro_mate_num, touro_mate_title, touro_mate_date, user_id
        FROM touro_mate;
    </select>
    
    <!-- 검색 게시물 -->
    <select id="searchMateList" resultType="TouroMateVO" parameterType="String">
        SELECT touro_mate_title, touro_mate_date, user_id FROM touro_mate
        <where>
            <if test="searchKeyword != null and searchKeyword.length() >= 2">
                AND touro_mate_title LIKE CONCAT('%', #{searchKeyword}, '%')
            </if>
        </where>
    </select>

    <!-- 전체 게시글 개수 -->
    <select id="getTotalMateCount" resultType="int">
        SELECT COUNT(*) FROM touro_mate;
    </select>

    <!-- insert 페이지 값 저장 -->
    <insert id="registerCourse" parameterType="TouroMateVO">
        INSERT INTO touro_mate (touro_mate_title, touro_mate_count, touro_mate_content,
        touro_mate_name1, touro_mate_name2, touro_mate_name3,
        touro_mate_addr1, touro_mate_addr2, touro_mate_addr3)
        
        VALUES (#{touro_mate_title}, #{touro_mate_count}, #{touro_mate_content},
        #{touro_mate_name1}, #{touro_mate_name2}, #{touro_mate_name3},
        #{touro_mate_addr1}, #{touro_mate_addr2}, #{touro_mate_addr3})
    </insert>

    <!-- detail 페이지 -->
    <select id="getTouroMateById" resultType="TouroMateVO" parameterType="Object">
        SELECT touro_mate_num, user_id, touro_mate_title, touro_mate_count, touro_mate_content,
            touro_mate_name1, touro_mate_name2, touro_mate_name3,
            touro_mate_addr1, touro_mate_addr2, touro_mate_addr3, touro_mate_date
        FROM touro_mate
        WHERE touro_mate_num = #{touro_mate_num}
    </select>

    <!-- 여행지 정보 가져오기 -->
    <select id="getTravelPlaces" resultType="TouroMateVO">
        SELECT touro_mate_num, touro_mate_name1, touro_mate_name2, touro_mate_name3,
            touro_mate_addr1, touro_mate_addr2, touro_mate_addr3
        FROM touro_mate
        WHERE touro_mate_num = #{touro_mate_num}
    </select>

    <!-- 게시글 작성자 정보 가져오기 -->
    <select id="getAuthorInfo" resultType="UserVO" parameterType="String">
        SELECT u.user_id, u.user_tel, u.user_email, u.user_gender, u.user_age,
            u.user_prefer_type1, u.user_prefer_type2, u.user_prefer_type3
        FROM touro_mate tm
        INNER JOIN user u ON tm.user_id = u.user_id
        WHERE tm.user_id = #{userId}
    </select>

</mapper>